<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>docker 基础知识 - 小炒肉</title><meta name=Description content="docker 基础知识"><meta property="og:title" content="docker 基础知识"><meta property="og:description" content="docker 基础知识"><meta property="og:type" content="article"><meta property="og:url" content="https://jicki.cn/docker-popularization/"><meta property="og:image" content="https://jicki.cn/logo.png"><meta property="article:published_time" content="2016-01-01T00:00:00+00:00"><meta property="article:modified_time" content="2016-01-01T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jicki.cn/logo.png"><meta name=twitter:title content="docker 基础知识"><meta name=twitter:description content="docker 基础知识"><meta name=application-name content="小炒肉"><meta name=apple-mobile-web-app-title content="小炒肉"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/images/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://jicki.cn/docker-popularization/><link rel=prev href=https://jicki.cn/docker-options/><link rel=next href=https://jicki.cn/update-kernel/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"docker 基础知识","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/jicki.cn\/docker-popularization\/"},"genre":"posts","wordcount":1698,"url":"https:\/\/jicki.cn\/docker-popularization\/","datePublished":"2016-01-01T00:00:00+00:00","dateModified":"2016-01-01T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"小炒肉"},"description":"docker 基础知识"}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=小炒肉>小炒肉</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=小炒肉>小炒肉</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/>文章</a><a class=menu-item href=/tags/>标签</a><a class=menu-item href=/categories/>分类</a><a class=menu-item href=/about/>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">docker 基础知识</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://jicki.cn title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>小炒肉</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/docker/><i class="far fa-folder fa-fw"></i>docker</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2016-01-01>2016-01-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 1698 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 4 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#一什么是docker>一、什么是docker</a></li><li><a href=#二资源限制与隔离>二、资源限制与隔离</a></li><li><a href=#三容器-vs-虚拟机>三、容器 VS 虚拟机</a></li><li><a href=#四docker-基础概念>四、docker 基础概念</a><ul><li><a href=#镜像image>镜像(image)</a></li><li><a href=#容器container>容器(Container)</a></li><li><a href=#仓库repository>仓库(Repository)</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=docker>Docker</h1><ul><li><p>本文用于科普 docker 的一些基础知识以及概念</p></li><li><p>LXC = Linux Container</p></li></ul><h2 id=一什么是docker>一、什么是docker</h2><ul><li>Docker 是一个开放源代码软件项目, 让应用程序部署在软件货柜下的工作可以自动化进行, 借此在 Linux 操作系统上, 提供一个额外的软件抽象层, 以及操作系统层虚拟化的自动管理机制。Docker 利用 Linux 核心中的资源分离机制，例如 <code>cgroups</code>,以及 Linux 核心名字空间<code>(LXC Namespace)</code>，来创建独立的容器。</li></ul><h2 id=二资源限制与隔离>二、资源限制与隔离</h2><ul><li><p>资源隔离 (Namespace):</p><ul><li>Linux 实现了 6 项资源隔离</li></ul></li></ul><table><thead><tr><th>Namespace</th><th>系统调用参数</th><th>隔离内容</th><th>支持内核版本</th></tr></thead><tbody><tr><td>UTS</td><td><code>CLONE_NEWUTS</code></td><td>主机名和域名</td><td>2.6.19</td></tr><tr><td>IPC</td><td><code>CLONE_NEWIPC</code></td><td>信号量、消息队列和共享内存</td><td>2.6.19</td></tr><tr><td>PID</td><td><code>CLONE_NEWPID</code></td><td>进程编号</td><td>2.6.24</td></tr><tr><td>NetWork</td><td><code>CLONE_NEWNET</code></td><td>网络设备、网络栈、端口等</td><td>2.6.29</td></tr><tr><td>Mount</td><td><code>CLONE_NEWNS</code></td><td>挂载点(文件系统)</td><td>2.4.19</td></tr><tr><td>User</td><td><code>CLONE_NEWUSER</code></td><td>用户和用户组</td><td>3.8</td></tr></tbody></table><ul><li><p>资源限制 (cgroups):</p><ul><li><p>Linux 通过 cgroups 实现 cpu、内存、IO的限制以及网络的分配, (Linux 系统目录 /sys/fs/cgroup/ )</p></li><li><p>限制内存以及虚拟内存并关闭oom-kill <code>docker run --memory 500M --memory-swap 200M --oom-kill-disable</code></p></li><li><p>绑定CPU核心 <code>docker run --cpu-cpus 1</code> , <code>docker run --cpuset-cpus="0-2"</code></p></li><li><p>限制CPU <code>docker run -c 2048 --cpu-period=50000 --cpu-quota=50000</code></p><ul><li><p><code>--cpu-quota</code> cpu调度范围</p></li><li><p><code>--cpu-period</code> cpu调度周期内使用时间</p></li><li><p><code>-c</code> cpu 核心ms值</p></li></ul></li><li><p>限制磁盘IO</p><ul><li><p><code>--device-read-bps</code> 限制此设备上的读速度(bytes per second), 单位可以是kb、mb或者gb</p></li><li><p><code>--device-read-iops</code> 通过每秒读IO次数来限制指定设备的读速度</p></li><li><p><code>--device-write-bps</code> 限制此设备上的写速度（bytes per second），单位可以是kb、mb或者gb。</p></li><li><p><code>--device-write-iops</code> 通过每秒写IO次数来限制指定设备的写速度。</p></li><li><p><code>--blkio-weight</code> 容器默认磁盘IO的加权值，有效值范围为10-100。</p></li><li><p><code>--blkio-weight-device</code> 针对特定设备的IO加权控制。其格式为<code>DEVICE_NAME:WEIGHT</code></p></li></ul></li></ul></li></ul><h2 id=三容器-vs-虚拟机>三、容器 VS 虚拟机</h2><ul><li><p>相比传统的虚拟化技术(vm), 使用Docker在CPU, Memory, Disk IO, Network IO 上的性能损耗都有同样水平甚至更优的表现。Container的快速创建、启动、销毁受到很多赞誉。</p></li><li><p>容器是直接使用宿主机的内核的, 而虚拟机(VM)是虚拟化一个完整操作系统。所以单数量上一台物理机能跑的容器是远大于虚拟机的数量。</p></li></ul><table><thead><tr><th>特性</th><th>容器</th><th>虚拟机</th></tr></thead><tbody><tr><td>启动</td><td>秒级</td><td>分钟级</td></tr><tr><td>使用容量</td><td>一般为MB</td><td>一般为GB</td></tr><tr><td>性能</td><td>接近宿主机性能</td><td>弱于宿主机性能</td></tr><tr><td>系统支持量</td><td>单机可支持上千容器</td><td>单机可支持几十个</td></tr></tbody></table><h2 id=四docker-基础概念>四、docker 基础概念</h2><h3 id=镜像image>镜像(image)</h3><ul><li><p>Docker镜像是一个特殊的文件系统，提供容器运行时所需的程序、库、资源、配置等文件，另外还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。</p></li><li><p>镜像是一个静态的概念，不包含任何动态数据，其内容在构建之后也不会被改变。</p></li><li><p>镜像是分层结构</p><ul><li>docker利用存储驱动 overlay2 的存储技术实现了镜像的分层结构, 分层结构中内容相同的层只占用一个空间, 意思就是只有不同的结构层才会占用存储空间, 相同的层都是直接引用。</li></ul></li><li><p>构建一个镜像</p><ul><li><p><code>docker build [option] [-t &lt;image>:&lt;tag>] &lt;path></code> 命令构建镜像</p></li><li><p><code>dockerfile</code></p><ul><li><p><code>FROM</code>: 指定基础镜像</p></li><li><p><code>ENV</code>: <code>key = value</code> 格式 - 设置一个环境变量, 可以被dockerfile里后续的指令使用, 也在容器运行过程中保持。</p></li><li><p><code>ARG</code>: <code>key = value</code> 格式 <code>docker build --build-arg &lt;varname>=&lt;value></code> 将该变量传递给构建器替换默认变量。</p></li><li><p><code>RUN</code>: 命令操作层,每一个RUN 会新增一层,所以目的相同的RUN尽量合并在同一个RUN里减少大小。</p></li><li><p><code>COPY</code>: 从本地复制 文件/文件夹 到镜像中。</p></li><li><p><code>ADD</code>: 从本地复制 文件/文件夹 到镜像中, 支持压缩文件自解压和网络中下载文件。</p></li><li><p><code>WORKDIR</code>: 声明工作目录,可以支持多个目录, 会自动创建目录。</p></li><li><p><code>USER</code>: 指定构建时 USER 后续操作的 用户。</p></li><li><p><code>EXPOSE</code>: 声明需要使用的端口, 仅用于声明与显示并不会实际映射端口到外部。<code>docker ps</code> PORTS 栏 会显示声明的端口。</p></li><li><p><code>VOLUME</code>: 容器运行时应该尽量保持容器存储层不发生写操作, 对于数据库类需要保存动态数据的应用, 其数据库文件应该保存于卷(volume)中, 为了防止运行时用户忘记将动态文件所保存目录挂载为卷，在 Dockerfile 中，我们可以事先指定某些目录挂载为匿名卷，这样在运行时如果用户不指定挂载，其应用也可以正常运行，不会向容器存储层写入大量数据。</p></li><li><p><code>CMD</code>: CMD 指令允许用户指定容器的默认执行的命令。此命令会在容器启动且 <code>docker run</code> 没有指定其他命令时运行。 CMD 可以用作 ENTRYPOINT 默认参数, 或者用作 Docker 的默认命令。</p></li><li><p><code>ENTRYPOINT</code>: ENTRYPOINT 的 Exec 格式用于设置容器启动时要执行的命令及其参数, 同时可通过CMD命令或者命令行参数提供额外的参数。ENTRYPOINT 中的参数始终会被使用, 这是与CMD命令不同的一点。</p></li></ul></li></ul></li></ul><h3 id=容器container>容器(Container)</h3><ul><li><p>Docker的容器就是 docker 通过镜像启动一个实例就叫 docker 容器。</p></li><li><p><code>docker run &lt;images name></code> 命令启动容器。</p></li></ul><h3 id=仓库repository>仓库(Repository)</h3></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2016-01-01</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/docker-popularization/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://jicki.cn/docker-popularization/ data-title="docker 基础知识" data-via=jicki234><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://jicki.cn/docker-popularization/><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://jicki.cn/docker-popularization/ data-title="docker 基础知识" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://jicki.cn/docker-popularization/ data-title="docker 基础知识"><i data-svg-src=/lib/simple-icons/icons/line.min.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://jicki.cn/docker-popularization/ data-title="docker 基础知识"><i class="fab fa-weibo fa-fw"></i></a><a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://jicki.cn/docker-popularization/ data-title="docker 基础知识" data-description="docker 基础知识"><i data-svg-src=/lib/simple-icons/icons/myspace.min.svg></i></a><a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://jicki.cn/docker-popularization/ data-title="docker 基础知识" data-description="docker 基础知识"><i class="fab fa-blogger fa-fw"></i></a><a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://jicki.cn/docker-popularization/ data-title="docker 基础知识"><i class="fab fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/docker-options/ class=prev rel=prev title="docker 基础设置"><i class="fas fa-angle-left fa-fw"></i>docker 基础设置</a>
<a href=/update-kernel/ class=next rel=next title="centos update kernel">centos update kernel<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.73.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://jicki.cn target=_blank>小炒肉</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp>粤ICP备20055633号</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>