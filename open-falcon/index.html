<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Open-Falcon 监控 - 小炒肉</title><meta name=Description content="Open-Falcon 监控"><meta property="og:title" content="Open-Falcon 监控"><meta property="og:description" content="Open-Falcon 监控"><meta property="og:type" content="article"><meta property="og:url" content="https://jicki.cn/open-falcon/"><meta property="og:image" content="https://jicki.cn/logo.png"><meta property="article:published_time" content="2017-08-18T00:00:00+00:00"><meta property="article:modified_time" content="2017-08-18T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jicki.cn/logo.png"><meta name=twitter:title content="Open-Falcon 监控"><meta name=twitter:description content="Open-Falcon 监控"><meta name=application-name content="小炒肉"><meta name=apple-mobile-web-app-title content="小炒肉"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/images/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://jicki.cn/open-falcon/><link rel=prev href=https://jicki.cn/kubernetes-1.7.3/><link rel=next href=https://jicki.cn/kubernetes-storageclass/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Open-Falcon 监控","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/jicki.cn\/open-falcon\/"},"genre":"posts","wordcount":4515,"url":"https:\/\/jicki.cn\/open-falcon\/","datePublished":"2017-08-18T00:00:00+00:00","dateModified":"2017-08-18T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"小炒肉"},"description":"Open-Falcon 监控"}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=小炒肉>小炒肉</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=小炒肉>小炒肉</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/>文章</a><a class=menu-item href=/tags/>标签</a><a class=menu-item href=/categories/>分类</a><a class=menu-item href=/about/>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Open-Falcon 监控</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://jicki.cn title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>小炒肉</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/linux/><i class="far fa-folder fa-fw"></i>linux</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2017-08-18>2017-08-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 4515 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 10 分钟&nbsp;<span id=/open-falcon/ class=leancloud_visitors data-flag-title="Open-Falcon 监控">
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#安装-golang>安装 golang</a></li><li><a href=#安装-mysql-57>安装 Mysql 5.7</a></li><li><a href=#安装-redis>安装 redis</a></li></ul><ul><li><a href=#初始化环境>初始化环境</a></li><li><a href=#导入数据库>导入数据库</a></li><li><a href=#编译-程序>编译 程序</a></li><li><a href=#配置-transfer>配置 Transfer</a></li><li><a href=#配置-graph>配置 Graph</a></li><li><a href=#配置-api-组件>配置 Api 组件</a></li><li><a href=#部署-heartbeat-服务>部署 Heartbeat 服务</a></li><li><a href=#部署-judge-服务>部署 Judge 服务</a></li><li><a href=#部署一个-mail-服务>部署一个 mail 服务</a></li><li><a href=#部署一个-微信网关>部署一个 微信网关</a></li><li><a href=#部署-alarm-服务>部署 Alarm 服务</a></li><li><a href=#配置-nodata-服务>配置 Nodata 服务</a></li><li><a href=#配置-aggregator-服务>配置 Aggregator 服务</a></li><li><a href=#启动所有服务>启动所有服务</a></li></ul><ul><li><a href=#初始化依赖>初始化依赖</a></li><li><a href=#安装配置-dashboard>安装配置 dashboard</a></li><li><a href=#启动-dashboard>启动 dashboard</a></li><li><a href=#登陆-web-ui>登陆 WEB UI</a></li></ul><ul><li><a href=#配置-报警名单>配置 报警名单</a></li><li><a href=#配置-nodata-监控-agent>配置 nodata 监控 agent</a></li><li><a href=#配置-系统监控指标>配置 系统监控指标</a></li></ul><ul><li><a href=#修改-报警模板>修改 报警模板</a></li></ul></nav></div></div><div class=content id=content><h1 id=环境准备>环境准备</h1><blockquote><p>官方文档 <a href=https://book.open-falcon.org/zh_0_2>https://book.open-falcon.org/zh_0_2</a></p></blockquote><h2 id=安装-golang>安装 golang</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>wget https://storage.googleapis.com/golang/go1.6.4.linux-amd64.tar.gz

tar zxvf go1.6.4.linux-amd64.tar.gz

mv go /opt/local/

# 增加环境变量

vi /etc/profile


# Golang ENV
export GOROOT=/opt/local/go
export PATH=$PATH:$GOROOT/bin
export GOPATH=/opt/local/golang

go version
go version go1.6.4 linux/amd64

</code></pre></td></tr></table></div></div><h2 id=安装-mysql-57>安装 Mysql 5.7</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 初始化依赖

yum -y install cmake ncurses ncurses-devel bison bison-devel boost boost-devel


# 创建 mysql 用户以及相关目录

/usr/sbin/groupadd mysql
/usr/sbin/useradd -g mysql mysql
mkdir -p /opt/local/mysql/data
mkdir -p /opt/local/mysql/binlog
mkdir -p  /opt/local/mysql/logs
mkdir -p /opt/local/mysql/relaylog
mkdir -p /var/lib/mysql
mkdir -p /opt/local/mysql/etc


# 下载 源码包

wget ftp://ftp.mirrorservice.org/sites/ftp.mysql.com/Downloads/MySQL-5.7/mysql-5.7.19.tar.gz

tar zxvf mysql-5.7.19.tar.gz

cd mysql-5.7.19

cmake -DCMAKE_INSTALL_PREFIX=&#34;/opt/local/mysql&#34; -DDEFAULT_CHARSET=utf8 \
-DMYSQL_DATADIR=&#34;/opt/local/mysql/data/&#34; -DCMAKE_INSTALL_PREFIX=&#34;/opt/local/mysql&#34; \
-DINSTALL_PLUGINDIR=plugin -DWITH_INNOBASE_STORAGE_ENGINE=1 -DDEFAULT_COLLATION=utf8_general_ci \
-DENABLED_LOCAL_INFILE=1 -DENABLED_PROFILING=1 -DWITH_ZLIB=system \
-DWITH_EXTRA_CHARSETS=none -DMYSQL_MAINTAINER_MODE=OFF -DEXTRA_CHARSETS=all \
-DWITH_PERFSCHEMA_STORAGE_ENGINE=1 -DWITH_MYISAM_STORAGE_ENGINE=1 \
-DDOWNLOAD_BOOST=1 -DWITH_BOOST=/usr/local/boost


make -j `cat /proc/cpuinfo | grep processor| wc -l`

make install


# 创建相关目录，授权

chmod +w /opt/local/mysql
chown -R mysql:mysql /opt/local/mysql
chmod +w /var/lib/mysql
chown -R mysql:mysql /var/lib/mysql
cp /opt/local/mysql/support-files/mysql.server  /etc/init.d/mysqld
chmod 755 /etc/init.d/mysqld
echo &#39;basedir=/opt/local/mysql/&#39; &gt;&gt; /etc/init.d/mysqld
echo &#39;datadir=/opt/local/mysql/data&#39; &gt;&gt;/etc/init.d/mysqld


# 创建关联

ln -s /opt/local/mysql/lib/mysql /usr/lib/mysql
ln -s /opt/local/mysql/include/mysql /usr/include/mysql
ln -s /opt/local/mysql/bin/mysql /usr/bin/mysql
ln -s /opt/local/mysql/bin/mysqldump /usr/bin/mysqldump
ln -s /opt/local/mysql/bin/myisamchk /usr/bin/myisamchk
ln -s /opt/local/mysql/bin/mysqld_safe /usr/bin/mysqld_safe
ln -s /tmp/mysql.sock /var/lib/mysql/mysql.sock


# 初始化数据库

vi /opt/local/mysql/etc/my.cnf

[client]
default-character-set=utf8mb4

[mysqld]
########basic settings########
server-id = 1
port = 3306
user = mysql
bind_address = 127.0.0.1
autocommit = 1
character_set_server=utf8mb4
collation-server=utf8mb4_unicode_ci
skip-character-set-client-handshake
init_connect=&#39;SET collation_connection = utf8mb4_unicode_ci&#39;
init_connect=&#39;SET NAMES utf8mb4&#39;
skip_name_resolve = 1
max_connections = 800
max_connect_errors = 1000
datadir = /opt/local/mysql/data
pid-file = /opt/local/mysql/mysql.pid
transaction_isolation = READ-COMMITTED
explicit_defaults_for_timestamp = 1
join_buffer_size = 134217728
tmp_table_size = 67108864
tmpdir = /tmp
max_allowed_packet = 16777216
sql_mode = &#34;STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER&#34;
interactive_timeout = 1800
wait_timeout = 1800
read_buffer_size = 16777216
read_rnd_buffer_size = 33554432
sort_buffer_size = 33554432
########log settings########
log_error = /opt/local/mysql/logs/mysqld.log
slow_query_log = 1
slow_query_log_file = /opt/local/mysql/logs/slow.log
log_queries_not_using_indexes = 1
log_slow_admin_statements = 1
log_slow_slave_statements = 1
log_throttle_queries_not_using_indexes = 10
expire_logs_days = 90
long_query_time = 2
min_examined_row_limit = 100
########replication settings########
master_info_repository = TABLE
relay_log_info_repository = TABLE
log_bin = /opt/local/mysql/binlog/mysql-bin
sync_binlog = 1
gtid_mode = on
enforce_gtid_consistency = 1
log_slave_updates
binlog_format = row
relay_log = /opt/local/mysql/relaylog/relay-bin
relay_log_recovery = 1
binlog_gtid_simple_recovery = 1
slave_skip_errors = ddl_exist_errors
########innodb settings########
innodb_page_size = 16384
innodb_buffer_pool_size = 8G
innodb_buffer_pool_instances = 8
innodb_buffer_pool_load_at_startup = 1
innodb_buffer_pool_dump_at_shutdown = 1
innodb_lru_scan_depth = 2000
innodb_lock_wait_timeout = 5
innodb_io_capacity = 4000
innodb_io_capacity_max = 8000
innodb_flush_method = O_DIRECT
innodb_file_format = Barracuda
innodb_file_format_max = Barracuda
innodb_log_group_home_dir = /opt/local/mysql/relaylog
innodb_undo_directory = /opt/local/mysql/binlog
innodb_undo_logs = 128
innodb_undo_tablespaces = 3
innodb_flush_neighbors = 1
innodb_log_file_size = 4G
innodb_log_buffer_size = 16777216
innodb_purge_threads = 4
innodb_large_prefix = 1
innodb_thread_concurrency = 64
innodb_print_all_deadlocks = 1
innodb_strict_mode = 1
innodb_sort_buffer_size = 67108864
############mysql 5.7 ##################
innodb_buffer_pool_dump_pct = 40
innodb_page_cleaners = 4
innodb_undo_log_truncate = 1
innodb_max_undo_log_size = 2G
innodb_purge_rseg_truncate_frequency = 128
binlog_gtid_simple_recovery=1
log_timestamps=system
transaction_write_set_extraction=MURMUR32
show_compatibility_56=on
########semi sync replication settings########
#plugin_dir=/opt/local/mysql/lib/plugin
#plugin_load = &#34;rpl_semi_sync_master=semisync_master.so;rpl_semi_sync_slave=semisync_slave.so&#34;
#loose_rpl_semi_sync_master_enabled = 1
#loose_rpl_semi_sync_slave_enabled = 1
#loose_rpl_semi_sync_master_timeout = 5000



rm -rf /etc/my.cnf

cd /opt/local/mysql/bin/

/opt/local/mysql/bin/mysqld --initialize --user=mysql --basedir=/opt/local/mysql --datadir=/opt/local/mysql/data

# 查看 mysql 密码

cat /opt/local/mysql/logs/mysqld.log |grep password


# 启动 mysql

service mysqld start

chkconfig mysqld on

# 设置安全配置

/opt/local/mysql/bin/mysql_secure_installation -uroot -p


# 登陆 mysql

mysql -uroot -p

</code></pre></td></tr></table></div></div><h2 id=安装-redis>安装 redis</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 下载 redis

wget http://download.redis.io/releases/redis-3.2.10.tar.gz

tar zxvf redis-3.2.10.tar.gz 

cd redis-3.2.10

make

make install

cd  utils

./install_server.sh

...... 输入相关信息 ......

cd /etc/init.d/

mv redis_6379  redis


# 创建 目录

mkdir -p /opt/local/redis/{data,logs,conf}

cd /opt/local/redis/conf

vi redis.conf


bind 127.0.0.1
protected-mode yes
port 6379
tcp-backlog 2048
timeout 0
tcp-keepalive 300
daemonize yes
supervised no
pidfile /var/run/redis.pid
loglevel notice
logfile &#34;/opt/local/redis/logs/redis.log&#34;
maxmemory 10gb
databases 16
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename redis_dump.rdb
dir /opt/local/redis/data
slave-serve-stale-data yes
slave-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
slave-priority 100
appendonly no
appendfilename &#34;appendonly.aof&#34;
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
lua-time-limit 5000
slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events &#34;&#34;
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit slave 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
aof-rewrite-incremental-fsync yes



# 启动 redis

chkconfig redis on

service redis start

</code></pre></td></tr></table></div></div><h1 id=配置-open-falcon>配置 Open-Falcon</h1><h2 id=初始化环境>初始化环境</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>mkdir -p $GOPATH/src/github.com/open-falcon
cd $GOPATH/src/github.com/open-falcon
git clone https://github.com/open-falcon/falcon-plus.git

</code></pre></td></tr></table></div></div><h2 id=导入数据库>导入数据库</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cd $GOPATH/src/github.com/open-falcon/falcon-plus/scripts/mysql/db_schema/
mysql -u root -p &lt; 1_uic-db-schema.sql
mysql -u root -p &lt; 2_portal-db-schema.sql
mysql -u root -p &lt; 3_dashboard-db-schema.sql
mysql -u root -p &lt; 4_graph-db-schema.sql
mysql -u root -p &lt; 5_alarms-db-schema.sql

</code></pre></td></tr></table></div></div><h2 id=编译-程序>编译 程序</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cd $GOPATH/src/github.com/open-falcon/falcon-plus/

# 编译所有的模块
make all


# 编译指定模块
make agent


# 打包
make pack


# 创建目录

mkdir /opt/local/open-falcon

mv open-falcon-v0.2.1.tar.gz /opt/local/open-falcon

cd /opt/local/open-falcon

tar zxvf open-falcon-v0.2.1.tar.gz 

[root@localhost open-falcon]# ls
agent  aggregator  alarm  api  gateway  graph  hbs  judge  nodata  open-falcon  plugins  public  transfer

</code></pre></td></tr></table></div></div><h2 id=配置-transfer>配置 Transfer</h2><blockquote><p>transfer是数据转发服务。它接收agent上报的数据，然后按照哈希规则进行数据分片、并将分片后的数据分别push给graph&judge等组件。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cd /opt/local/open-falcon/transfer/config

vi cfg.json

{
    &#34;debug&#34;: true,
    &#34;minStep&#34;: 30,
    &#34;http&#34;: {
        &#34;enabled&#34;: true,
        &#34;listen&#34;: &#34;0.0.0.0:6060&#34;
    },
    &#34;rpc&#34;: {
        &#34;enabled&#34;: true,
        &#34;listen&#34;: &#34;0.0.0.0:8433&#34;
    },
    &#34;socket&#34;: {
        &#34;enabled&#34;: false,
        &#34;listen&#34;: &#34;0.0.0.0:4444&#34;,
        &#34;timeout&#34;: 3600
    },
    &#34;judge&#34;: {
        &#34;enabled&#34;: true,
        &#34;batch&#34;: 200,
        &#34;connTimeout&#34;: 1000,
        &#34;callTimeout&#34;: 5000,
        &#34;maxConns&#34;: 32,
        &#34;maxIdle&#34;: 32,
        &#34;replicas&#34;: 500,
        &#34;cluster&#34;: {
            &#34;judge-00&#34; : &#34;127.0.0.1:6080&#34;
        }
    },
    &#34;graph&#34;: {
        &#34;enabled&#34;: true,
        &#34;batch&#34;: 200,
        &#34;connTimeout&#34;: 1000,
        &#34;callTimeout&#34;: 5000,
        &#34;maxConns&#34;: 32,
        &#34;maxIdle&#34;: 32,
        &#34;replicas&#34;: 500,
        &#34;cluster&#34;: {
            &#34;graph-00&#34; : &#34;127.0.0.1:6070&#34;
        }
    },
    &#34;tsdb&#34;: {
        &#34;enabled&#34;: false,
        &#34;batch&#34;: 200,
        &#34;connTimeout&#34;: 1000,
        &#34;callTimeout&#34;: 5000,
        &#34;maxConns&#34;: 32,
        &#34;maxIdle&#34;: 32,
        &#34;retry&#34;: 3,
        &#34;address&#34;: &#34;127.0.0.1:8088&#34;
    }
}


</code></pre></td></tr></table></div></div><h2 id=配置-graph>配置 Graph</h2><blockquote><p>graph是存储绘图数据的组件。graph组件 接收transfer组件推送上来的监控数据，同时处理api组件的查询请求、返回绘图数据。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 创建数据 目录

mkdir -p /opt/data/6070


cd /opt/local/open-falcon/graph/config

vi cfg.json

{
    &#34;debug&#34;: false,
    &#34;http&#34;: {
        &#34;enabled&#34;: true,
        &#34;listen&#34;: &#34;0.0.0.0:6071&#34;
    },
    &#34;rpc&#34;: {
        &#34;enabled&#34;: true,
        &#34;listen&#34;: &#34;0.0.0.0:6070&#34;
    },
    &#34;rrd&#34;: {
        &#34;storage&#34;: &#34;/opt/data/6070&#34;
    },
    &#34;db&#34;: {
        &#34;dsn&#34;: &#34;root:123456@tcp(127.0.0.1:3306)/graph?loc=Local&amp;parseTime=true&#34;,
        &#34;maxIdle&#34;: 4
    },
    &#34;callTimeout&#34;: 5000,
    &#34;migrate&#34;: {
            &#34;enabled&#34;: false,
            &#34;concurrency&#34;: 2,
            &#34;replicas&#34;: 500,
            &#34;cluster&#34;: {
                    &#34;graph-00&#34; : &#34;127.0.0.1:6070&#34;
            }
    }
}


</code></pre></td></tr></table></div></div><h2 id=配置-api-组件>配置 Api 组件</h2><blockquote><p>api组件，提供统一的restAPI操作接口。比如：api组件接收查询请求，根据一致性哈希算法去相应的graph实例查询不同metric的数据，然后汇总拿到的数据，最后统一返回给用户。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cd /opt/local/open-falcon/api/config

vi cfg.json 
# 主要修改 &#34;salt&#34;: &#34;&#34; 为加密字串

{
        &#34;log_level&#34;: &#34;debug&#34;,
        &#34;db&#34;: {
                &#34;falcon_portal&#34;: &#34;root:123456@tcp(127.0.0.1:3306)/falcon_portal?charset=utf8&amp;parseTime=True&amp;loc=Local&#34;,
                &#34;graph&#34;: &#34;root:123456@tcp(127.0.0.1:3306)/graph?charset=utf8&amp;parseTime=True&amp;loc=Local&#34;,
                &#34;uic&#34;: &#34;root:123456@tcp(127.0.0.1:3306)/uic?charset=utf8&amp;parseTime=True&amp;loc=Local&#34;,
                &#34;dashboard&#34;: &#34;root:123456@tcp(127.0.0.1:3306)/dashboard?charset=utf8&amp;parseTime=True&amp;loc=Local&#34;,
                &#34;alarms&#34;: &#34;root:123456@tcp(127.0.0.1:3306)/alarms?charset=utf8&amp;parseTime=True&amp;loc=Local&#34;,
                &#34;db_bug&#34;: true
        },
        &#34;graphs&#34;: {
                &#34;cluster&#34;: {
                        &#34;graph-00&#34;: &#34;127.0.0.1:6070&#34;
                },
                &#34;max_conns&#34;: 100,
                &#34;max_idle&#34;: 100,
                &#34;conn_timeout&#34;: 1000,
                &#34;call_timeout&#34;: 5000,
                &#34;numberOfReplicas&#34;: 500
        },
        &#34;metric_list_file&#34;: &#34;./api/data/metric&#34;,
        &#34;web_port&#34;: &#34;0.0.0.0:8080&#34;,
        &#34;access_control&#34;: true,
        &#34;signup_disable&#34;: false,
        &#34;salt&#34;: &#34;pleaseinputwhichyouareusingnow&#34;,
        &#34;skip_auth&#34;: false,
        &#34;default_token&#34;: &#34;default-token-used-in-server-side&#34;,
        &#34;gen_doc&#34;: false,
        &#34;gen_doc_path&#34;: &#34;doc/module.html&#34;
}


</code></pre></td></tr></table></div></div><h2 id=部署-heartbeat-服务>部署 Heartbeat 服务</h2><blockquote><p>心跳服务器，所有agent都会连到HBS，每分钟发一次心跳请求。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cd /opt/local/open-falcon/hbs/config

vi cfg.json


{
    &#34;debug&#34;: true,
    &#34;database&#34;: &#34;root:123456@tcp(127.0.0.1:3306)/falcon_portal?loc=Local&amp;parseTime=true&#34;,
    &#34;hosts&#34;: &#34;&#34;,
    &#34;maxConns&#34;: 20,
    &#34;maxIdle&#34;: 15,
    &#34;listen&#34;: &#34;:6030&#34;,
    &#34;trustable&#34;: [&#34;&#34;],
    &#34;http&#34;: {
        &#34;enabled&#34;: true,
        &#34;listen&#34;: &#34;0.0.0.0:6031&#34;
    }
}


</code></pre></td></tr></table></div></div><h2 id=部署-judge-服务>部署 Judge 服务</h2><blockquote><p>Judge用于告警判断，agent将数据push给Transfer，Transfer不但会转发给Graph组件来绘图，还会转发给Judge用于判断是否触发告警。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cd /opt/local/open-falcon/judge/config

vi cfg.json

{
    &#34;debug&#34;: true,
    &#34;debugHost&#34;: &#34;nil&#34;,
    &#34;remain&#34;: 11,
    &#34;http&#34;: {
        &#34;enabled&#34;: true,
        &#34;listen&#34;: &#34;0.0.0.0:6081&#34;
    },
    &#34;rpc&#34;: {
        &#34;enabled&#34;: true,
        &#34;listen&#34;: &#34;0.0.0.0:6080&#34;
    },
    &#34;hbs&#34;: {
        &#34;servers&#34;: [&#34;127.0.0.1:6030&#34;],
        &#34;timeout&#34;: 300,
        &#34;interval&#34;: 60
    },
    &#34;alarm&#34;: {
        &#34;enabled&#34;: true,
        &#34;minInterval&#34;: 300,
        &#34;queuePattern&#34;: &#34;event:p%v&#34;,
        &#34;redis&#34;: {
            &#34;dsn&#34;: &#34;127.0.0.1:6379&#34;,
            &#34;maxIdle&#34;: 5,
            &#34;connTimeout&#34;: 5000,
            &#34;readTimeout&#34;: 5000,
            &#34;writeTimeout&#34;: 5000
        }
    }
}

</code></pre></td></tr></table></div></div><h2 id=部署一个-mail-服务>部署一个 mail 服务</h2><blockquote><p>发送警告邮件需要部署一个 mail 服务 用于发送邮件, 这里边部署一个简单的
mail-provider 地址 <a href=https://github.com/zzlyzq/mail-provider>https://github.com/zzlyzq/mail-provider</a></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 下载 依赖模块

cd /opt/local/golang/src/github.com/open-falcon

git clone https://github.com/zzlyzq/mail-provider

cd /opt/local/golang/src/github.com/open-falcon/mail-provider

# 下载依赖
go get 

./control build (编译)

./control pack (打包)

mkdir /opt/local/open-falcon/mail-provider

mv falcon-mail-provider-0.0.1.tar.gz /opt/local/open-falcon/mail-provider

cd /opt/local/open-falcon/mail-provider

tar zxvf falcon-mail-provider-0.0.1.tar.gz


# 修改配置文件 里的 smtp 为自己的地址
# QQ邮箱，请开启 smtp 的功能，在QQ邮箱后台开启

vi cfg.json

{
    &#34;debug&#34;: true,
    &#34;http&#34;: {
        &#34;listen&#34;: &#34;0.0.0.0:4000&#34;,
        &#34;token&#34;: &#34;&#34;
    },
    &#34;smtp&#34;: {
        &#34;addr&#34;: &#34;smtp.qq.com:587&#34;,
        &#34;username&#34;: &#34;jicki@qq.com&#34;,
        &#34;password&#34;: &#34;123456&#34;,
        &#34;from&#34;: &#34;jicki@qq.com&#34;
    }
}



# 运行程序

./control start

# 查看日志
./control tail



# 测试, 在测试时 token 暂时设置为空


curl http://127.0.0.1:4000/sender/mail -d &#34;tos=jicki@qq.com&amp;subject=xx&amp;content=yy&#34;

</code></pre></td></tr></table></div></div><h2 id=部署一个-微信网关>部署一个 微信网关</h2><blockquote><p>微信网关 git <a href=https://github.com/Yanjunhui/chat>https://github.com/Yanjunhui/chat</a></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cd /opt/local/open-falcon

git clone https://github.com/Yanjunhui/chat

cd chat/

chmod +x control.sh

# 需要修改 配置文件

cat config.conf


#http 服务端口
[http]
port = 4567

#微信接口信息
[weixin]
CorpID = ww6424d33203e90e20
AgentId = 1000002
Secret = FoST_8RQSTjZwH_CN3aQW6UKksjCSI9mizFqD7HKhrw
EncodingAESKey = K2M3WMhRHIOH4I1Ww5jxpllGrgY01nvBjUgTvcJEEHX


# 启动
./control.sh start
./control.sh status



## 注意: 

要收到 im 报警信息，必须要在 个人用户里面 填写 微信相关资料

微信相关帐号是  登陆微信公众号 --&gt; 通讯里， 里面用户的 帐号

不是个人微信帐号，填写个人帐号，是收不到报警的。

</code></pre></td></tr></table></div></div><h2 id=部署-alarm-服务>部署 Alarm 服务</h2><blockquote><p>alarm模块是处理报警event的，judge产生的报警event写入redis，alarm从redis读取处理，并进行不同渠道的发送。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cd /opt/local/open-falcon/alarm/config

vi cfg.json


{
    &#34;log_level&#34;: &#34;debug&#34;,
    &#34;http&#34;: {
        &#34;enabled&#34;: true,
        &#34;listen&#34;: &#34;0.0.0.0:9912&#34;
    },
    &#34;redis&#34;: {
        &#34;addr&#34;: &#34;127.0.0.1:6379&#34;,
        &#34;maxIdle&#34;: 5,
        &#34;highQueues&#34;: [
            &#34;event:p0&#34;,
            &#34;event:p1&#34;,
            &#34;event:p2&#34;
        ],
        &#34;lowQueues&#34;: [
            &#34;event:p3&#34;,
            &#34;event:p4&#34;,
            &#34;event:p5&#34;,
            &#34;event:p6&#34;
        ],
        &#34;userIMQueue&#34;: &#34;/queue/user/im&#34;,
        &#34;userSmsQueue&#34;: &#34;/queue/user/sms&#34;,
        &#34;userMailQueue&#34;: &#34;/queue/user/mail&#34;
    },
    &#34;api&#34;: {
        &#34;im&#34;: &#34;http://127.0.0.1:4567/send&#34;,
        &#34;sms&#34;: &#34;http://127.0.0.1:10086/sms&#34;,
        &#34;mail&#34;: &#34;http://127.0.0.1:4000/sender/mail&#34;,
        &#34;dashboard&#34;: &#34;http://127.0.0.1:8081&#34;,
        &#34;plus_api&#34;:&#34;http://127.0.0.1:8080&#34;,
        &#34;plus_api_token&#34;: &#34;default-token-used-in-server-side&#34;
    },
    &#34;falcon_portal&#34;: {
        &#34;addr&#34;: &#34;root:123456@tcp(127.0.0.1:3306)/alarms?charset=utf8&amp;loc=Asia%2FChongqing&#34;,
        &#34;idle&#34;: 10,
        &#34;max&#34;: 100
    },
    &#34;worker&#34;: {
        &#34;im&#34;: 10,
        &#34;sms&#34;: 10,
        &#34;mail&#34;: 50
    },
    &#34;housekeeper&#34;: {
        &#34;event_retention_days&#34;: 7,
        &#34;event_delete_batch&#34;: 100
    }
}

</code></pre></td></tr></table></div></div><h2 id=配置-nodata-服务>配置 Nodata 服务</h2><blockquote><p>nodata用于检测监控数据的上报异常。nodata和实时报警judge模块协同工作，过程为: 配置了nodata的采集项超时未上报数据，nodata生成一条默认的模拟数据；用户配置相应的报警策略，收到mock数据就产生报警。采集项上报异常检测，作为judge模块的一个必要补充，能够使judge的实时报警功能更加可靠、完善。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cd /opt/local/open-falcon/nodata/config

vi cfg.json 

{
    &#34;debug&#34;: true,
    &#34;http&#34;: {
        &#34;enabled&#34;: true,
        &#34;listen&#34;: &#34;0.0.0.0:6090&#34;
    },
    &#34;plus_api&#34;:{
        &#34;connectTimeout&#34;: 500,
        &#34;requestTimeout&#34;: 2000,
        &#34;addr&#34;: &#34;http://127.0.0.1:8080&#34;,
        &#34;token&#34;: &#34;default-token-used-in-server-side&#34;
    },
    &#34;config&#34;: {
        &#34;enabled&#34;: true,
        &#34;dsn&#34;: &#34;root:123456@tcp(127.0.0.1:3306)/falcon_portal?loc=Local&amp;parseTime=true&amp;wait_timeout=604800&#34;,
        &#34;maxIdle&#34;: 4
    },
    &#34;collector&#34;:{
        &#34;enabled&#34;: true,
        &#34;batch&#34;: 200,
        &#34;concurrent&#34;: 10
    },
    &#34;sender&#34;:{
        &#34;enabled&#34;: true,
        &#34;connectTimeout&#34;: 500,
        &#34;requestTimeout&#34;: 2000,
        &#34;transferAddr&#34;: &#34;127.0.0.1:6060&#34;,
        &#34;batch&#34;: 500
    }
}


</code></pre></td></tr></table></div></div><h2 id=配置-aggregator-服务>配置 Aggregator 服务</h2><blockquote><p>集群聚合模块。聚合某集群下的所有机器的某个指标的值，提供一种集群视角的监控体验。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cd /opt/local/open-falcon/aggregator/config

vi cfg.json

{
    &#34;debug&#34;: true,
    &#34;http&#34;: {
        &#34;enabled&#34;: false,
        &#34;listen&#34;: &#34;0.0.0.0:6055&#34;
    },
    &#34;database&#34;: {
        &#34;addr&#34;: &#34;root:123456@tcp(127.0.0.1:3306)/falcon_portal?loc=Local&amp;parseTime=true&#34;,
        &#34;idle&#34;: 10,
        &#34;ids&#34;: [1, -1],
        &#34;interval&#34;: 55
    },
    &#34;api&#34;: {
        &#34;connect_timeout&#34;: 500,
        &#34;request_timeout&#34;: 2000,
        &#34;plus_api&#34;: &#34;http://127.0.0.1:8080&#34;,
        &#34;plus_api_token&#34;: &#34;default-token-used-in-server-side&#34;,
        &#34;push_api&#34;: &#34;http://127.0.0.1:1988/v1/push&#34;
    }
}


</code></pre></td></tr></table></div></div><h2 id=启动所有服务>启动所有服务</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cd /opt/local/open-falcon

./open-falcon start

./open-falcon check
        falcon-graph         UP           71646 
          falcon-hbs         UP           71658 
        falcon-judge         UP           71670 
     falcon-transfer         UP           71678 
       falcon-nodata         UP           71686 
   falcon-aggregator         UP           71695 
        falcon-agent         UP           71706 
      falcon-gateway         UP           71715 
          falcon-api         UP           71724 
        falcon-alarm         UP           71738 

</code></pre></td></tr></table></div></div><h1 id=配置-agent>配置 Agent</h1><blockquote><p>agent用于采集机器负载监控指标，比如cpu.idle、load.1min、disk.io.util等等，每隔60秒push给Transfer。agent与Transfer建立了长连接，数据发送速度比较快，agent提供了一个http接口/v1/push用于接收用户手工push的一些数据，然后通过长连接迅速转发给Transfer。</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>
cd /opt/local/open-falcon/agent/config

# Agent 配置文件


{
    &#34;debug&#34;: true,
    &#34;hostname&#34;: &#34;&#34;,
    &#34;ip&#34;: &#34;&#34;,
    &#34;plugin&#34;: {
        &#34;enabled&#34;: false,
        &#34;dir&#34;: &#34;./plugin&#34;,
        &#34;git&#34;: &#34;https://github.com/open-falcon/plugin.git&#34;,
        &#34;logs&#34;: &#34;./logs&#34;
    },
    &#34;heartbeat&#34;: {
        &#34;enabled&#34;: true,
        &#34;addr&#34;: &#34;127.0.0.1:6030&#34;,
        &#34;interval&#34;: 60,
        &#34;timeout&#34;: 1000
    },
    &#34;transfer&#34;: {
        &#34;enabled&#34;: true,
        &#34;addrs&#34;: [
            &#34;127.0.0.1:8433&#34;
        ],
        &#34;interval&#34;: 60,
        &#34;timeout&#34;: 1000
    },
    &#34;http&#34;: {
        &#34;enabled&#34;: false,
        &#34;listen&#34;: &#34;:1988&#34;,
        &#34;backdoor&#34;: false
    },
    &#34;collector&#34;: {
        &#34;ifacePrefix&#34;: [&#34;eth&#34;, &#34;em&#34;],
        &#34;mountPoint&#34;: []
    },
    &#34;default_tags&#34;: {
    },
    &#34;ignore&#34;: {
        &#34;cpu.busy&#34;: true,
        &#34;df.bytes.free&#34;: true,
        &#34;df.bytes.total&#34;: true,
        &#34;df.bytes.used&#34;: true,
        &#34;df.bytes.used.percent&#34;: true,
        &#34;df.inodes.total&#34;: true,
        &#34;df.inodes.free&#34;: true,
        &#34;df.inodes.used&#34;: true,
        &#34;df.inodes.used.percent&#34;: true,
        &#34;mem.memtotal&#34;: true,
        &#34;mem.memused&#34;: true,
        &#34;mem.memused.percent&#34;: true,
        &#34;mem.memfree&#34;: true,
        &#34;mem.swaptotal&#34;: true,
        &#34;mem.swapused&#34;: true,
        &#34;mem.swapfree&#34;: true
    }
}




</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># agent 脚本  添加 hostname = IP</span>

<span class=c1>#!/bin/bash</span>
mkdir /opt/local
<span class=nb>cd</span> /opt/local
wget http://172.16.1.100/agent.tar.gz
tar zxvf agent.tar.gz
rm -rf agent.tar.gz
<span class=nv>IPADDR</span><span class=o>=</span><span class=sb>`</span>ifconfig em1<span class=p>|</span>grep inet<span class=p>|</span>grep -v 127.0.0.1<span class=p>|</span>grep -v inet6<span class=p>|</span>awk <span class=s1>&#39;{print $2}&#39;</span><span class=p>|</span>tr -d <span class=s2>&#34;addr:&#34;</span><span class=sb>`</span>
sed -i <span class=s1>&#39;s/\&#34;hostname\&#34;\:.*$/\&#34;hostname\&#34;\: \&#34;&#39;</span><span class=nv>$IPADDR</span><span class=s1>&#39;\&#34;\,/g&#39;</span> open-falcon/agent/config/cfg.json
cat open-falcon/agent/config/cfg.json
<span class=nb>cd</span> open-falcon
./open-falcon start agent
./open-falcon check agent

</code></pre></td></tr></table></div></div><h1 id=配置前端-dashboard>配置前端 dashboard</h1><h2 id=初始化依赖>初始化依赖</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>yum install -y python-virtualenv
yum install -y python-devel
yum install -y openldap-devel
yum install -y mysql-devel
yum groupinstall &#34;Development tools&#34;

</code></pre></td></tr></table></div></div><h2 id=安装配置-dashboard>安装配置 dashboard</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cd /opt/local/open-falcon

git clone https://github.com/open-falcon/dashboard.git

cd dashboard

# 创建 python 独立运行环境

virtualenv ./env

# 安装 python 依赖模块

# 执行安装

./env/bin/pip install -r pip_requirements.txt -i http://mirrors.aliyun.com/pypi/simple/



# 修改配置

# 修改里面的 mysql 配置

rrd/config.py

ALARM_DB_PASS

</code></pre></td></tr></table></div></div><h2 id=启动-dashboard>启动 dashboard</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># debug 模式

./env/bin/python wsgi.py


# 正常模式

bash control start


# 查看日志
bash control tail 

</code></pre></td></tr></table></div></div><h2 id=登陆-web-ui>登陆 WEB UI</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>
http://172.16.1.100:8081/


注册  root 帐号  为 admin 帐号

</code></pre></td></tr></table></div></div><h1 id=监控报警>监控报警</h1><h2 id=配置-报警名单>配置 报警名单</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 首先配置 用户组

dashboard --&gt; Welcome root --&gt;  Teams 

Add+  -- &gt; Create Team

# 创建一个 ICT 组

名称： ICT
简介： 运维组
成员： root

</code></pre></td></tr></table></div></div><h2 id=配置-nodata-监控-agent>配置 nodata 监控 agent</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 创建 HostGrop

dashboard --&gt; HostGroups

添加一个名称 dev-server 的 HostGroups

点击 hosts -- &gt; Add Host  添加  dev 相关服务器 

</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 创建 nodata
# 监控 client 的 agent ，如果 agent 掉了， 那么无法上传数据，所以直接配置
模板是不行的， 必须配置 nodata 在 agent 抓不到数据的时候 值为 -1 . 

dashboard --&gt; nodata

Add nodata

name: nodata.agent

endpoint选择:   机器分组  ---  dev-server

metric: agent.alive

type: GAUGE

周期: 60

数据上报中断时，补发如下值: -1


</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 创建 策略配置

dashboard --&gt; Templates

创建一个 名称为 agent-alive 的模板


# 模板基础信息:

name: agent-alive

模板策略列表:

metric: agent.alive   note: 无法连接agent

if [all(#3)] &lt; 0 : alarm(); callback();

save 保存

# 模板报警配置:

之前设置的 ICT



# Save
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 绑定 模板

dashboard --&gt; HostGroups

查找  dev-server   点击  templates

查找  agent-alive   选择 + Bind

</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 测试

关闭一个 agent 的进程


等待60秒 查看 Alarm-Dashboard


等待收取邮件~


</code></pre></td></tr></table></div></div><h2 id=配置-系统监控指标>配置 系统监控指标</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>dashboard --&gt; Templates

Add 添加一个 系统指标模块

监控指标如下:
</code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://jicki.cn/img/posts/openfalcon/sys.png data-srcset="https://jicki.cn/img/posts/openfalcon/sys.png, https://jicki.cn/img/posts/openfalcon/sys.png 1.5x, https://jicki.cn/img/posts/openfalcon/sys.png 2x" data-sizes=auto alt=https://jicki.cn/img/posts/openfalcon/sys.png title=sys.png-60.9kB></p><h1 id=faq>FAQ</h1><h2 id=修改-报警模板>修改 报警模板</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=nx>cd</span> <span class=nx>open</span><span class=o>-</span><span class=nx>falcon</span><span class=o>/</span><span class=nx>falcon</span><span class=o>-</span><span class=nx>plus</span><span class=o>/</span><span class=nx>modules</span><span class=o>/</span><span class=nx>alarm</span><span class=o>/</span><span class=nx>cron</span>


<span class=err>#</span> <span class=nx>报警内容</span><span class=p>:</span>

<span class=nx>cat</span> <span class=nx>builder</span><span class=p>.</span><span class=k>go</span>



<span class=kn>package</span> <span class=nx>cron</span>

<span class=kn>import</span> <span class=p>(</span>
        <span class=s>&#34;fmt&#34;</span>

        <span class=s>&#34;github.com/open-falcon/falcon-plus/common/model&#34;</span>
        <span class=s>&#34;github.com/open-falcon/falcon-plus/common/utils&#34;</span>
        <span class=s>&#34;github.com/open-falcon/falcon-plus/modules/alarm/g&#34;</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>BuildCommonSMSContent</span><span class=p>(</span><span class=nx>event</span> <span class=o>*</span><span class=nx>model</span><span class=p>.</span><span class=nx>Event</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span>
                <span class=s>&#34;[P%d][%s][%s][][%s %s %s %s %s%s%s][O%d %s]&#34;</span><span class=p>,</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>Priority</span><span class=p>(),</span>
                <span class=nx>event</span><span class=p>.</span><span class=nx>Status</span><span class=p>,</span>
                <span class=nx>event</span><span class=p>.</span><span class=nx>Endpoint</span><span class=p>,</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>Note</span><span class=p>(),</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>Func</span><span class=p>(),</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>Metric</span><span class=p>(),</span>
                <span class=nx>utils</span><span class=p>.</span><span class=nf>SortedTags</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>PushedTags</span><span class=p>),</span>
                <span class=nx>utils</span><span class=p>.</span><span class=nf>ReadableFloat</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>LeftValue</span><span class=p>),</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>Operator</span><span class=p>(),</span>
                <span class=nx>utils</span><span class=p>.</span><span class=nf>ReadableFloat</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nf>RightValue</span><span class=p>()),</span>
                <span class=nx>event</span><span class=p>.</span><span class=nx>CurrentStep</span><span class=p>,</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>FormattedTime</span><span class=p>(),</span>
        <span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>BuildCommonIMContent</span><span class=p>(</span><span class=nx>event</span> <span class=o>*</span><span class=nx>model</span><span class=p>.</span><span class=nx>Event</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span>
                <span class=s>&#34;[报警级别: %d][报警状态: %s][报警Host: %s][报警内容: %s][报警时间: %s]&#34;</span><span class=p>,</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>Priority</span><span class=p>(),</span>
                <span class=nx>event</span><span class=p>.</span><span class=nx>Status</span><span class=p>,</span>
                <span class=nx>event</span><span class=p>.</span><span class=nx>Endpoint</span><span class=p>,</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>Note</span><span class=p>(),</span>
                <span class=c1>//event.Func(),
</span><span class=c1></span>                <span class=c1>//event.Metric(),
</span><span class=c1></span>                <span class=c1>//utils.SortedTags(event.PushedTags),
</span><span class=c1></span>                <span class=c1>//utils.ReadableFloat(event.LeftValue),
</span><span class=c1></span>                <span class=c1>//event.Operator(),
</span><span class=c1></span>                <span class=c1>//utils.ReadableFloat(event.RightValue()),
</span><span class=c1></span>                <span class=c1>//event.CurrentStep,
</span><span class=c1></span>                <span class=nx>event</span><span class=p>.</span><span class=nf>FormattedTime</span><span class=p>(),</span>
        <span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>BuildCommonMailContent</span><span class=p>(</span><span class=nx>event</span> <span class=o>*</span><span class=nx>model</span><span class=p>.</span><span class=nx>Event</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
        <span class=nx>link</span> <span class=o>:=</span> <span class=nx>g</span><span class=p>.</span><span class=nf>Link</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span>
        <span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span>
                <span class=s>&#34;报警状态: %s\r\n报警级别: %d\r\n报警Host: %s\r\n报警事件: %s\r\n事件标签: %s\r\n报警表达式: %s: %s%s%s\r\n报警内容: %s\r\n最大报警次数: %d   当前报警次数: %d\r\n报警时间: %s\r\n报警模板: %s\r\n&#34;</span><span class=p>,</span>
                <span class=nx>event</span><span class=p>.</span><span class=nx>Status</span><span class=p>,</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>Priority</span><span class=p>(),</span>
                <span class=nx>event</span><span class=p>.</span><span class=nx>Endpoint</span><span class=p>,</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>Metric</span><span class=p>(),</span>
                <span class=nx>utils</span><span class=p>.</span><span class=nf>SortedTags</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>PushedTags</span><span class=p>),</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>Func</span><span class=p>(),</span>
                <span class=nx>utils</span><span class=p>.</span><span class=nf>ReadableFloat</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>LeftValue</span><span class=p>),</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>Operator</span><span class=p>(),</span>
                <span class=nx>utils</span><span class=p>.</span><span class=nf>ReadableFloat</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nf>RightValue</span><span class=p>()),</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>Note</span><span class=p>(),</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>MaxStep</span><span class=p>(),</span>
                <span class=nx>event</span><span class=p>.</span><span class=nx>CurrentStep</span><span class=p>,</span>
                <span class=nx>event</span><span class=p>.</span><span class=nf>FormattedTime</span><span class=p>(),</span>
                <span class=nx>link</span><span class=p>,</span>
        <span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>GenerateSmsContent</span><span class=p>(</span><span class=nx>event</span> <span class=o>*</span><span class=nx>model</span><span class=p>.</span><span class=nx>Event</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nf>BuildCommonSMSContent</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>GenerateMailContent</span><span class=p>(</span><span class=nx>event</span> <span class=o>*</span><span class=nx>model</span><span class=p>.</span><span class=nx>Event</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nf>BuildCommonMailContent</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>GenerateIMContent</span><span class=p>(</span><span class=nx>event</span> <span class=o>*</span><span class=nx>model</span><span class=p>.</span><span class=nx>Event</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nf>BuildCommonIMContent</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span>
<span class=p>}</span>


</code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2017-08-18</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/open-falcon/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://jicki.cn/open-falcon/ data-title="Open-Falcon 监控" data-via=jicki234><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://jicki.cn/open-falcon/><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://jicki.cn/open-falcon/ data-title="Open-Falcon 监控" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://jicki.cn/open-falcon/ data-title="Open-Falcon 监控"><i data-svg-src=/lib/simple-icons/icons/line.min.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://jicki.cn/open-falcon/ data-title="Open-Falcon 监控"><i class="fab fa-weibo fa-fw"></i></a><a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://jicki.cn/open-falcon/ data-title="Open-Falcon 监控" data-description="Open-Falcon 监控"><i data-svg-src=/lib/simple-icons/icons/myspace.min.svg></i></a><a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://jicki.cn/open-falcon/ data-title="Open-Falcon 监控" data-description="Open-Falcon 监控"><i class="fab fa-blogger fa-fw"></i></a><a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://jicki.cn/open-falcon/ data-title="Open-Falcon 监控"><i class="fab fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/kubernetes-1.7.3/ class=prev rel=prev title="kubernetes 1.7.3 + calico 多 Master"><i class="fas fa-angle-left fa-fw"></i>kubernetes 1.7.3 + calico 多 Master</a>
<a href=/kubernetes-storageclass/ class=next rel=next title="Kubernetes Storage Class">Kubernetes Storage Class<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.73.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://jicki.cn target=_blank>小炒肉</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp>粤ICP备20055633号</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/valine/Valine.min.js></script><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"comment":{"valine":{"appId":"1LTTCvDe4Nt8XSdFzejtUsVF-gzGzoHsz","appKey":"cvpPM7sbgOw0pTXbh6YVKrjc","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"zh-cn","pageSize":10,"placeholder":"你的评论 ...","recordIP":true,"visitor":true}},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>